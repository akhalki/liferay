AUI().add("liferay-plugin-mail",function(a){Liferay.Mail={init:function(c){var b=this;b.namespace=c.namespace;b.accountId=c.initialAccountId;b.folderId=c.initialFolderId;b.accountsContainer=a.one("#accountsContainer");b.composeContainer=a.one("#composeContainer");b.controlContainer=a.one("#controlContainer");b.contentContainer=a.one("#contentContainer");b.foldersContainer=a.one("#foldersContainer");b.mailContainer=a.one("#mailContainer");b.manageFoldersContainer=a.one("#manageFoldersContainer");b.messageContainer=a.one("#messageContainer");b.messagesContainer=a.one("#messagesContainer");b._assignEvents();if(b.accountId==0){return}b.loadAccount(b.accountId,b.folderId)},addAccount:function(){var b=this;new a.Dialog({centered:true,cssClass:"mail-dialog",destroyOnClose:true,modal:true,title:Liferay.Language.get("add-account"),width:600}).plug(a.Plugin.IO,{uri:themeDisplay.getLayoutURL()+"/-/mail/add_account"}).render()},checkMessages:function(c){var b=this;if(b.accountId<=0){return}a.io.request(themeDisplay.getLayoutURL()+"/-/mail/check_messages",{data:{accountId:b.accountId,folderId:c},dataType:"json",method:"POST",on:{success:function(e,g,f){var d=this.get("responseData");if((d.status!="success")||(d.value=="false")){return}b.loadFolders(b.accountId);if(b.folderId==c){b.loadMessages(c,b.pageNumber,b.orderByField,b.orderByType,b.keywords,true)}}}})},deleteMessages:function(c){var b=this;b.setStatus("info",Liferay.Language.get("deleting-messages"));a.io.request(themeDisplay.getLayoutURL()+"/-/mail/delete_messages",{data:{messageIds:c},dataType:"json",method:"POST",on:{failure:function(d,f,e){b.setStatus("error",Liferay.Language.get("unable-to-connect-with-mail-server"))},success:function(e,g,f){var d=this.get("responseData");b.setStatus(d.status,d.message);if(d.status=="success"){b.loadMessages(b.folderId,b.pageNumber,b.orderByField,b.orderByType,b.keywords)}}}})},editAccount:function(d){var b=this;var c=new a.Dialog({centered:true,cssClass:"mail-dialog",destroyOnClose:true,modal:true,title:Liferay.Language.get("edit-account"),width:600}).plug(a.Plugin.IO,{data:{accountId:d},uri:themeDisplay.getLayoutURL()+"/-/mail/edit_account"}).render()},flagMessages:function(c,e,d){var b=this;b.setStatus("info",Liferay.Language.get("flagging-messages"));a.io.request(themeDisplay.getLayoutURL()+"/-/mail/flag_messages",{data:{flag:c,messageIds:d,value:e},dataType:"json",method:"POST",on:{failure:function(f,h,g){b.setStatus("error",Liferay.Language.get("unable-to-connect-with-mail-server"))},success:function(g,i,h){var f=this.get("responseData");b.setStatus(f.status,f.message);b.loadMessages(b.folderId,b.pageNumber,b.orderByField,b.orderByType,b.keywords)}}})},loadAccounts:function(c){var b=this;b.accountsContainer.io.set("data",{accountId:c});b.accountsContainer.io.start()},loadAccount:function(d,c){var b=this;b._displayContainer(b.messagesContainer);a.io.request(themeDisplay.getLayoutURL()+"/-/mail/password_saved",{data:{accountId:d,inboxFolderId:c},method:"POST",on:{failure:function(e,g,f){b.setStatus("error",Liferay.Language.get("unable-to-connect-with-mail-server"))},success:function(f,h,g){var e=this.get("responseData");if(a.DataType.Boolean.parse(e)){b.accountId=d;b.inboxFolderId=c;b.loadFolders(d);b.loadMessages(c,1,"sentDate","desc","")}else{b.passwordPrompt(d,c)}}}})},loadCompose:function(f,c,d,e){var b=this;b._displayContainer(b.composeContainer);b.composeContainer.io.set("data",{accountId:f,messageId:c,messageType:d,replyMessageId:e});b.composeContainer.io.start()},loadFolders:function(c){var b=this;b.controlContainer.show();b.foldersContainer.io.set("data",{accountId:c});b.foldersContainer.io.start()},loadManageFolders:function(c){var b=this;b._displayContainer(b.manageFoldersContainer);b.manageFoldersContainer.io.set("data",{accountId:c});b.manageFoldersContainer.io.start()},loadMessage:function(c,e,f,g,d){var b=this;b.folderId=c;b.orderByField=f;b.orderByType=g;b.keywords=d;b._displayContainer(b.messageContainer);b.messageContainer.io.set("data",{folderId:c,messageNumber:e,orderByField:f,orderByType:g,keywords:d});b.messageContainer.io.start()},loadMessages:function(d,c,g,h,f,e){var b=this;b.folderId=d;b.pageNumber=c;b.orderByField=g;b.orderByType=h;b.keywords=f;if(e){b.messagesContainer.io.set("showLoading",false)}else{b._displayContainer(b.messagesContainer);if(c==1){b.checkMessages(d)}}b.messagesContainer.io.set("data",{folderId:d,pageNumber:c,orderByField:g,orderByType:h,keywords:f});b.messagesContainer.io.start();b.messagesContainer.io.set("showLoading",true)},moveMessages:function(c,d){var b=this;b.setStatus("info",Liferay.Language.get("moving-messages"));a.io.request(themeDisplay.getLayoutURL()+"/-/mail/move_messages",{data:{folderId:c,messageIds:d},dataType:"json",method:"POST",on:{failure:function(e,g,f){b.setStatus("error",Liferay.Language.get("unable-to-connect-with-mail-server"))},success:function(f,h,g){var e=this.get("responseData");b.setStatus(e.status,e.message);b.loadFolders(b.accountId);b.loadMessages(b.folderId,b.pageNumber,b.orderByField,b.orderByType,b.keywords)}}})},passwordPrompt:function(d,c){var b=this;new a.Dialog({centered:true,cssClass:"mail-dialog",destroyOnClose:true,modal:true,title:Liferay.Language.get("password"),width:600}).plug(a.Plugin.IO,{data:{accountId:d,inboxFolderId:c},uri:themeDisplay.getLayoutURL()+"/-/mail/password_prompt"}).render()},reset:function(){var b=this;b.accountId=null;b.folderId=null;b.inboxFolderId=null;b.keywords="";b.orderByField="sentDate";b.orderByType="desc";b.pageNumber=1;b.composeContainer.html("");b.foldersContainer.html("");b.manageFoldersContainer.html("");b.messageContainer.html("");b.messagesContainer.html("");b.controlContainer.hide();b.loadAccounts()},setStatus:function(g,h,f){var b=this;var e="portlet-msg-error";if(g=="success"){e="portlet-msg-success"}else{if(g=="info"){e="portlet-msg-info"}}var d=a.all(".mail-status").html('<table style="margin: 0 auto;"><tr><td>&nbsp;</td><td><span class="message '+e+'">'+h+"</span></td><td>&nbsp;</td></tr></table>");var c=d.all("table");if(!f){setTimeout(function(){c.remove()},5000)}},_assignEvents:function(){var b=this;b.accountsContainer.plug(a.Plugin.IO,{autoLoad:true,data:{accountId:b.accountId},method:"POST",showLoading:false,uri:themeDisplay.getLayoutURL()+"/-/mail/view_accounts"});b.composeContainer.plug(a.Plugin.IO,{autoLoad:false,method:"POST",on:{success:function(c){try{window[b.namespace+"editor"]=null;delete window[b.namespace+"editor"]}catch(d){}}},uri:themeDisplay.getLayoutURL()+"/-/mail/compose"});b.foldersContainer.plug(a.Plugin.IO,{autoLoad:false,method:"POST",showLoading:false,uri:themeDisplay.getLayoutURL()+"/-/mail/view_folders"});b.messageContainer.plug(a.Plugin.IO,{autoLoad:false,method:"POST",uri:themeDisplay.getLayoutURL()+"/-/mail/view_message"});b.messagesContainer.plug(a.Plugin.IO,{autoLoad:false,method:"POST",uri:themeDisplay.getLayoutURL()+"/-/mail/view_messages"});b.accountsContainer.delegate("click",function(e){var d=e.currentTarget;var f=d.getAttribute("data-accountId");var c=d.getAttribute("data-inboxFolderId");b.loadAccounts(f);b.loadAccount(f,c)},".folders-link");b.composeContainer.delegate("click",function(e){var d=e.currentTarget.one('input[type="button"]');var c=d.getAttribute("data-messageId");b.deleteMessages([c])},".discard-draft");b.contentContainer.delegate("click",function(f){var e=f.currentTarget;var c=e.getAttribute("data-folderId");var g=e.getAttribute("data-messageNumber");var h=e.getAttribute("data-orderByField");var i=e.getAttribute("data-orderByType");var d=e.getAttribute("data-keywords");b.loadMessage(c,g,h,i,d)},".message-link");b.contentContainer.delegate("click",function(e){var d=e.currentTarget;var c=d.getAttribute("data-messageId");b.loadCompose(b.accountId,c,"edit",0)},".draft-link");b.foldersContainer.delegate("click",function(c){b.editAccount(b.accountId)},".edit-account");b.foldersContainer.delegate("click",function(c){b.loadManageFolders(b.accountId)},".manage-folders");b.mailContainer.delegate("click",function(g){var f=g.currentTarget;var d=f.getAttribute("data-folderId");var c=f.getAttribute("data-pageNumber");var h=f.getAttribute("data-orderByField");var i=f.getAttribute("data-orderByType");var e=f.getAttribute("data-keywords");b.loadMessages(d,c,h,i,e)},".messages-link");b.mailContainer.delegate("click",function(f){var e=f.currentTarget;if(!e.hasAttribute("data-messageType")){e=e.one('input[type="button"]')}var c=e.getAttribute("data-messageId");var d=e.getAttribute("data-messageType");var g=e.getAttribute("data-replyMessageId");b.loadCompose(b.accountId,c,d,g)},".compose-message");b.manageFoldersContainer.plug(a.Plugin.IO,{autoLoad:false,method:"POST",uri:themeDisplay.getLayoutURL()+"/-/mail/manage_folders"});b.messageContainer.delegate("click",function(e){var d=e.currentTarget.one('input[type="button"]');var c=d.getAttribute("data-messageId");b.deleteMessages([c])},".delete-message");b.messagesContainer.delegate("click",function(d){var c=b._getSelectedMessageIds();b.deleteMessages(c)},".delete-messages");b.messagesContainer.delegate("change",function(e){var d=b._getSelectedMessageIds();var c=e.currentTarget.one("select").get("value").split(",");b.flagMessages(c[0],c[1],d)},".flag-messages");b.messagesContainer.delegate("change",function(e){var c=e.currentTarget.one("select").get("value");var d=b._getSelectedMessageIds();b.moveMessages(c,d)},".move-messages");b.messagesContainer.delegate("click",function(d){var c=b.messagesContainer.one(".search input").val();b.loadMessages(b.folderId,1,b.orderByField,b.orderByType,c)},".search-messages");b.messagesContainer.delegate("keyup",function(d){if(d.keyCode!=13){return}var c=b.messagesContainer.one(".search input").val();b.loadMessages(b.folderId,1,b.orderByField,b.orderByType,c)},".search");b.messagesContainer.delegate("click",function(c){b.messagesContainer.all("input[type=checkbox]").each(function(e,d,f){e.set("checked",true)})},".select-all");b.messagesContainer.delegate("click",function(c){b.messagesContainer.all("input[type=checkbox]").each(function(e,d,f){e.set("checked",false)})},".select-none");setTimeout("Liferay.Mail._pollCheckMessages()",b._pollInterval)},_displayContainer:function(c){var b=this;b.composeContainer.hide();b.manageFoldersContainer.hide();b.messagesContainer.hide();b.messageContainer.hide();c.show()},_getSelectedMessageIds:function(){var b=this;var c=[];b.messagesContainer.all("input[type=checkbox]").each(function(f,e,g){var d=f.getAttribute("messageId");if(d&&f.get("checked")){c.push(d)}});return c},_pollCheckMessages:function(){var b=this;b.checkMessages(b.inboxFolderId);setTimeout("Liferay.Mail._pollCheckMessages()",b._pollInterval)},accountId:null,folderId:null,inboxFolderId:null,keywords:"",orderByField:"sentDate",orderByType:"desc",pageNumber:1,_pollInterval:60000}},"",{requires:["aui-base","aui-datatype","aui-dialog","aui-io"]});